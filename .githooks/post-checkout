#!/usr/bin/env bash
set -euo pipefail

REPO_ROOT="$(git rev-parse --show-toplevel)"
cd "$REPO_ROOT"

# If lockfiles changed, run bootstrap
if git diff --name-only HEAD@{1} HEAD | grep -E '(package-lock.json|composer.lock|.vscode/|.env.example|tools/bootstrap.ps1)' >/dev/null 2>&1; then
  if command -v pwsh >/dev/null 2>&1; then
    pwsh -NoProfile -ExecutionPolicy Bypass -File tools/bootstrap.ps1 || true
  elif command -v powershell >/dev/null 2>&1; then
    powershell -NoProfile -ExecutionPolicy Bypass -File tools/bootstrap.ps1 || true
  else
    echo "No PowerShell found; skipping bootstrap" >&2
  fi
fi
